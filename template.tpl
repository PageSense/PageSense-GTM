___INFO___

{
  "displayName": "PageSense Tag",
  "description": "This tag will inject PageSense's tracking code snippet on the website pages that have the Google Tag Manager snippet installed.",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "You can get the space name in the Project Info section under the Settings tab of your PageSense app.",
    "displayName": "Space name",
    "simpleValueType": true,
    "name": "portalName",
    "type": "TEXT"
  },
  {
    "help": "You can get the project key in the Project Info section under the Settings tab of your PageSense app.",
    "displayName": "Project key",
    "simpleValueType": true,
    "name": "projectKey",
    "type": "TEXT"
  },
  {
    "help": "You can get the data center in the Project Info section under the Settings tab of your PageSense app.",
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "US",
        "value": "cdn.pagesense.io"
      },
      {
        "displayValue": "EU",
        "value": "cdn-eu.pagesense.io"
      },
      {
        "displayValue": "IN",
        "value": "cdn-in.pagesense.io"
      },
      {
        "displayValue": "CN",
        "value": "cdn.pagesense.cn"
      },
      {
        "displayValue": "AU",
        "value": "cdn-au.pagesense.io"
      }
    ],
    "displayName": "Data center",
    "simpleValueType": true,
    "name": "dataCenter",
    "type": "SELECT"
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.pagesense.io/"
              },
              {
                "type": 1,
                "string": "https://*.pagesense.cn/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const encodeUriComponent = require('encodeUriComponent');


const portalName = data.portalName;
const projectKey = data.projectKey;
const dataCenter = data.dataCenter;

const url = 
'https://' + encodeUriComponent(dataCenter) + '/js/' + encodeUriComponent(portalName) + '/' + encodeUriComponent(projectKey) + '.js'; 

const onSuccess = () => {
  data.gtmOnSuccess();
};

const onFailure = () => {
  data.gtmOnFailure();
};

if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);

} else {
  data.gtmOnFailure();
}


___NOTES___

Created on 16/09/2019, 19:57:49
